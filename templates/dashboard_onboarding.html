{% extends "layout.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h2 class="card-title">Willkommen bei ShopPulseAI!</h2>
                    <p class="lead">Ihre KI-gestützte Shop-Optimierung wird gerade eingerichtet. In wenigen Tagen haben Sie Zugriff auf wertvolle Insights und Empfehlungen.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-light">
                    <h4><i class="fas fa-chart-line me-2"></i>Onboarding-Fortschritt</h4>
                </div>
                <div class="card-body">
                    {% for step in onboarding.steps %}
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="mb-0">{{ step.title }}</h5>
                            <span class="badge bg-primary">{{ step.progress|round }}%</span>
                        </div>
                        <p>{{ step.description }}</p>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" 
                                 data-progress="{{ step.progress }}"
                                 style="width: 0%;" 
                                 aria-valuenow="0" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100">
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="card-footer bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Aktueller Status:</strong>
                            <ul class="list-unstyled mt-2">
                                <li><i class="fas fa-eye me-2"></i>Seitenaufrufe: <strong>{{ shop_data.total_pageviews }}</strong></li>
                                <li><i class="fas fa-mouse-pointer me-2"></i>Klicks: <strong>{{ shop_data.total_clicks }}</strong></li>
                            </ul>
                        </div>
                        <a href="/dashboard" class="btn btn-primary">
                            <i class="fas fa-sync-alt me-1"></i> Aktualisieren
                        </a>
                    </div>
                </div>
            </div>

            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-light">
                    <h4><i class="fas fa-lightbulb me-2"></i>Erste Schritte</h4>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <strong>1. Tracking-Skript einbinden</strong>
                                <span class="badge bg-success">Erledigt</span>
                            </div>
                            <p class="mb-0 mt-2 text-muted">Das Tracking-Skript wurde erfolgreich in Ihrem Shop installiert.</p>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <strong>2. Daten sammeln</strong>
                                <span class="badge bg-primary">Läuft</span>
                            </div>
                            <p class="mb-0 mt-2 text-muted">Wir sammeln Nutzerdaten, um Ihnen personalisierte Empfehlungen zu geben.</p>
                        </div>
                        <div class="list-group-item">
                            <strong>3. Erste Empfehlungen abrufen</strong>
                            <p class="mb-0 mt-2 text-muted">In 3-5 Tagen erhalten Sie Ihre ersten KI-generierten Optimierungsvorschläge.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-light">
                    <h4><i class="fas fa-magic me-2"></i>Vorschau: Ihr personalisiertes Dashboard</h4>
                </div>
                <div class="card-body text-center p-4" id="dashboard-preview">
                    <img src="{{ url_for('static', filename='img/dashboard-preview.png') }}" class="img-fluid rounded mb-3 shadow-sm" alt="Dashboard Vorschau" onerror="this.src='https://via.placeholder.com/600x300?text=Dashboard+Vors'">
                    <p>In Kürze sehen Sie hier Ihre echten Shop-Daten, Kunden-Insights und KI-generierte Optimierungsvorschläge.</p>
                </div>
            </div>

            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-light">
                    <h4><i class="fas fa-chart-pie me-2"></i>Beispiel-Statistiken</h4>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-sm-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Konversionsrate</h5>
                                    <h2 class="display-4">{{ onboarding.example_data.conversion_rate }}</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Umsatzsteigerung</h5>
                                    <h2 class="display-4">+24%</h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="mb-3">Beliebte Produkte (Beispiel)</h5>
                    <ul class="list-group mb-0">
                        {% for product in onboarding.example_data.popular_products %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-box me-2 text-primary"></i>
                                {{ product.name }}
                            </div>
                            <span class="badge bg-primary rounded-pill">{{ product.views }} Aufrufe</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h4><i class="fas fa-question-circle me-2"></i>Häufige Fragen</h4>
                </div>
                <div class="card-body">
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    Wie lange dauert es, bis ich personalisierte Empfehlungen erhalte?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Sobald wir etwa 100 Seitenaufrufe gesammelt haben (ca. 3-5 Tage), beginnen wir mit der Generierung personalisierter Empfehlungen. Je mehr Daten wir sammeln, desto genauer werden unsere Empfehlungen.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    Kann ich sofort auf alle Funktionen zugreifen?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Sie können jetzt bereits den Growth Advisor und Price Optimizer erkunden, die mit Beispieldaten gefüllt sind. Diese werden automatisch mit Ihren echten Daten aktualisiert, sobald genügend Informationen gesammelt wurden.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                    Welche Art von Empfehlungen kann ich erwarten?
                                </button>
                            </h2>
                            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    ShopPulseAI liefert Empfehlungen für Preisoptimierung, Cross-Selling-Möglichkeiten, Produktsortimentsoptimierung und Website-Verbesserungen. Alle Empfehlungen basieren auf Ihren tatsächlichen Kundendaten und dem Verhalten Ihrer Besucher.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Setze die Fortschrittsbalken-Werte
    document.querySelectorAll('[data-progress]').forEach(element => {
        const progress = element.getAttribute('data-progress');
        element.style.width = progress + '%';
        element.setAttribute('aria-valuenow', progress);
    });
    
    // Simulation einer Datensammlung mit animiertem Fortschrittsbalken
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
        const currentWidth = parseFloat(bar.style.width);
        if (currentWidth < 5) {
            // Kleiner Animation für sehr niedrige Werte, damit es nicht statisch wirkt
            setInterval(() => {
                const random = Math.random() * 0.5;
                const newWidth = Math.min(currentWidth + random, currentWidth + 1);
                bar.style.width = newWidth + '%';
                bar.setAttribute('aria-valuenow', newWidth);
            }, 5000);
        }
    });
    
    // Chart-Daten für die Vorschau
    if (typeof Chart !== 'undefined') {
        try {
            // Sichere Methode, um die JSON-Daten für das Chart zu erhalten
            var pageviewDataString = '{{ onboarding.example_data.pageviews_chart|tojson|safe }}';
            var pageviewData = JSON.parse(pageviewDataString);
            
            // Container für das Chart erstellen
            var chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            chartContainer.style.height = '300px';
            chartContainer.style.width = '100%';
            chartContainer.style.marginTop = '20px';
            
            // Canvas innerhalb des Containers erstellen
            var canvas = document.createElement('canvas');
            canvas.id = 'pageviewsChart';
            chartContainer.appendChild(canvas);
            
            // Container zum Dashboard-Preview hinzufügen
            var container = document.getElementById('dashboard-preview');
            if (container) {
                container.appendChild(chartContainer);
                
                // Chart mit fester Höhe erstellen
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: pageviewData.labels,
                        datasets: pageviewData.datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            title: {
                                display: true,
                                text: 'Seitenaufrufe & Besucher (Beispiel)'
                            }
                        }
                    }
                });
                
                // Stellen Sie sicher, dass die Größe nicht verändert wird
                window.addEventListener('resize', function() {
                    // Halten Sie die Höhe konstant
                    chartContainer.style.height = '300px';
                });
            }
        } catch (e) {
            console.error('Fehler beim Erstellen des Charts:', e);
        }
    }
});
</script>
{% endblock %} 